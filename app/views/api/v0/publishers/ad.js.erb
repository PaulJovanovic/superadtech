(function (global) {
  var wrapper = document.createElement("div");
  wrapper.style.overflow = "hidden";
  wrapper.style.height = "0px";
  var square = document.createElement("img");
  square.src = "<%= @ad.image %>";
  square.style.height = "auto";
  square.style.margin = "auto";
  square.style.display =  "block";
  square.style.maxWidth = "100%";
  wrapper.appendChild(square);
  document.getElementById("jovatech-widget").appendChild(wrapper);

  var scroll = function() {
    var winW = 630, winH = 460;
    if (document.body && document.body.offsetWidth) {
      winW = document.body.offsetWidth;
      winH = document.body.offsetHeight;
    }
    if (document.compatMode=='CSS1Compat' &&
        document.documentElement &&
        document.documentElement.offsetWidth ) {
      winW = document.documentElement.offsetWidth;
      winH = document.documentElement.offsetHeight;
    }
    if (window.innerWidth && window.innerHeight) {
      winW = window.innerWidth;
      winH = window.innerHeight;
    }
    var wrapperTop = wrapper.getBoundingClientRect().top;
    var wrapperHeightMax = square.offsetHeight;
    var height = 0;
    var widgetHeight = (winH + wrapperHeightMax) / 2 - wrapperTop;
    if (widgetHeight > 0) {
      height = Math.min(widgetHeight, wrapperHeightMax);
    }
    wrapper.style.height = height + "px";
  };
  scroll();
  global.onscroll = scroll;
})(this);

